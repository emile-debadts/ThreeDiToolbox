language: generic
sudo: required
dist: xenial

env:
    - QGIS_REPO=ppa:ubuntugis/ubuntugis-unstable HDF5_DIR=/usr/lib/x86_64-linux-gnu/hdf5/serial/

addons:
  apt:
    packages:
      - python-software-properties
      - libhdf5-serial-dev
      - libnetcdf-dev
      - xvfb  # emulating X-server
      - pyqt4-dev-tools

before_install:
    - sudo apt-get -qq -y update

install:
    # See: https://github.com/tomchadwin/qgis2web/blob/master/.travis.yml
    - sudo sh -c 'echo "deb https://qgis.org/ubuntugis  xenial main" >> /etc/apt/sources.list'
    - sudo sh -c 'echo "deb-src https://qgis.org/ubuntugis xenial main" >> /etc/apt/sources.list'
    - sudo add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable
    - sudo add-apt-repository ${QGIS_REPO}
    - sudo apt-get update
    - sudo apt-get install -y --force-yes qgis python-qgis
    - pip3 install --no-binary=h5py h5py
    # linux requirements
    - sudo pip install -r requirements-dev.txt
    # required pure python packages
    - pip install -r requirements.txt --target=external --no-deps

script:
    # this script adds standard qgis plugins (like db_manager) to PYTHONPATH
    - source scripts/run-env-linux.sh /usr
    - xvfb-run make test
    - make pep8

notifications:
    email: false

cache:
    directories:
    - $HOME/.cache/pip
