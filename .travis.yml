language: generic
dist: xenial

env:
    - UID=1000 USER=qgis_user

services:
  - docker

addons:
  apt:
    packages:
      - xvfb  # emulating X-server

before_install:
  - cd Docker/base
  - ls -la
  - docker build -t qgis-desktop:base .
  - cd ../..
  - docker-compose build

script:
  - docker-compose run -e QT_QPA_PLATFORM=offscreen qgis-desktop make test
  - docker-compose run qgis-desktop make pep8

notifications:
    email: false